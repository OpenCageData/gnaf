{

"settings": { "index": { "analysis": {
  "analyzer": {
    "d61Whitespace": {
      "tokenizer": "whitespace",
      "filter": [ "lowercase" ]
    },
    "d61Shingle": {
      "tokenizer": "whitespace",
      "filter": [ "lowercase", "filter_shingle" ]
    }
  },
  "filter": {
    "filter_shingle": {
      "type": "shingle",
      "max_shingle_size": 2,
      "min_shingle_size": 2,
      "output_unigrams": "true"
    }
  }
} } },

"mappings": { "gnaf": { "properties": {
  // comments not normally allowed in JSON, but this doesn't appear to break Elasticsearch
  
  // composite for string fields that are mostly null (mapped to "D61_NULL" in the index to make them searchable)
  "d61NullStr": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL" },
  
  // composite for numeric fields that are mostly null (mapped to -1 in the index to make them searchable)
  "d61NullInt": { "type": "string", "analyzer": "d61Whitespace", "null_value": "-1" },
  
  // composites for search
  "d61SiteBuilding": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL" },
  "d61Level": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL" },
  "d61Flat": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL" },
  "d61Street": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL" },
  "d61Locality": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL" },
  
  // suggesters
  "d61Address": { "type": "string", "position_increment_gap": 100, "analyzer": "d61Shingle" },
  
  "addressDetailPid": { "type": "string", "index": "not_analyzed" },
  "addressSiteName": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61SiteBuilding" ] },
  "buildingName": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61SiteBuilding" ] },
  
  "flatTypeCode": { "type": "string", "index": "not_analyzed", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Flat" ] },
  "flatTypeName": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Flat" ] },
  "flat": { "type": "object", "properties": {
    "prefix": { "type": "string", "index": "not_analyzed", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Flat" ] },
    "number": { "type": "integer", "null_value": -1, "copy_to": [ "d61NullInt", "d61Flat" ] },
    "suffix": { "type": "string", "index": "not_analyzed", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Flat" ] }
  } },
  
  "levelTypeCode": { "type": "string", "index": "not_analyzed", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Level" ] },
  "levelTypeName": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Level" ] }, // UPPER GROUND FLOOR
  "level": { "type": "object", "properties": {
    "prefix": { "type": "string", "index": "not_analyzed", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Level" ] },
    "number": { "type": "integer", "null_value": -1, "copy_to": [ "d61NullInt", "d61Level" ] },
    "suffix": { "type": "string", "index": "not_analyzed", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Level" ] }
  } },
  
  "numberFirst": { "type": "object", "properties": {
    "prefix": { "type": "string", "index": "not_analyzed", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Street" ] },
    "number": { "type": "integer", "null_value": -1, "copy_to": [ "d61NullInt", "d61Street" ] }, // TODO: maybe numbers shouldn't go in composite fields
    "suffix": { "type": "string", "index": "not_analyzed", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Street" ] }
  } },
  
  "numberLast": { "type": "object", "properties": {
    "prefix": { "type": "string", "index": "not_analyzed", "copy_to": [ "d61NullStr", "d61Street" ] },
    "number": { "type": "integer", "null_value": -1, "copy_to": [ "d61NullInt", "d61Street" ] },
    "suffix": { "type": "string", "index": "not_analyzed", "copy_to": [ "d61NullStr", "d61Street" ] }
  } },
  
  "street": { "type": "object", "properties": {
    "name": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Street" ] },
    "typeCode": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Street" ] }, // reversed from other lookup tables!
    "typeName": { "type": "string", "index": "not_analyzed", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Street" ] },  // code is long, name is short abbreviation
    "suffixCode": {"type": "string", "index": "not_analyzed", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Street" ] },
    "suffixName": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Street" ] }
  } },
  
  "localityName": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Locality" ] },
  "stateAbbreviation": { "type": "string", "index": "not_analyzed", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Locality" ] },
  "stateName": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Locality" ] },
  "postcode": { "type": "string", "index": "not_analyzed", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Locality" ] }, // string in GNAF, not a bad choice as not used as a number
  
  "aliasPrincipal": { "type": "string", "index": "not_analyzed", "null_value": "0" },   // TODO: in H2 & Scala this is Option[Char] so "0" used rather than "D61_NULL"
  "primarySecondary": { "type": "string", "index": "not_analyzed", "null_value": "0" }, // however if we convert the null here we could use the latter
  
  "location": { "type": "geo_point" },
  
  "streetVariant": { "type": "nested", "properties": {
    "name": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Street" ] },
    "typeCode": { "type": "string", "index": "not_analyzed", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Street" ] },
    "typeName": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Street" ] },
    "suffixCode": {"type": "string", "index": "not_analyzed", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Street" ] },
    "suffixName": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Street" ] }
  } },
  
  "localityVariant": { "type": "nested", "properties": {
    "localityName": { "type": "string", "analyzer": "d61Whitespace", "null_value": "D61_NULL", "copy_to": [ "d61NullStr", "d61Locality" ] }
  } }
} } }

}